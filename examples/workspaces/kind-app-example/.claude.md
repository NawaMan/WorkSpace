# TODO App with KIND - Project Progress

## Status: BUILT & DEPLOYED - Container Restart Needed for Port Bindings

## Last Session Summary
- ✅ Converted web app from Node.js/npm to **Bun**
- ✅ Fixed Go modules (`go mod tidy` for api and export-service)
- ✅ Built all Docker images successfully
- ✅ Created KIND cluster
- ✅ Deployed app to KIND (all pods running)
- ✅ Configured `.booth/config.toml` with port bindings
- ⏳ Container restart needed to apply port bindings

## Ports Configuration

| Port | Service | Description |
|------|---------|-------------|
| 3000 | Web UI | React/Vite dev server |
| 8080 | API | Go REST API + WebSocket |
| 8081 | Export | Go export service (CSV/JSON) |
| 5432 | PostgreSQL | Database |

## Next Steps After Container Restart

1. **Check if KIND cluster exists:**
   ```bash
   kind get clusters
   ```

2. **If cluster doesn't exist, create and deploy:**
   ```bash
   kind create cluster
   ./build.sh      # Images may be cached
   ./deploy-app.sh
   ```

3. **If cluster exists, check pod status:**
   ```bash
   kubectl get pods -n todo-app
   ```

4. **Start port-forward and access app:**
   ```bash
   kubectl port-forward svc/web 3000:80 -n todo-app
   # Open http://localhost:3000
   ```

## Overview
A real-world-like TODO application demonstrating:
- React frontend with real-time updates via WebSocket
- Go REST API backend
- Go Export Service (service-to-service communication)
- PostgreSQL database
- Deployed to KIND (Kubernetes IN Docker)
- Comprehensive testing (API E2E + Playwright UI tests)

## Project Structure

```
/home/coder/code/
├── build.sh              # Build all Docker images
├── deploy-app.sh         # Deploy to KIND cluster
├── remove-app.sh         # Remove from KIND cluster
│
├── api/                  # Go API Service (port 8080)
│   ├── main.go
│   ├── go.mod
│   ├── go.sum            # ✅ Generated
│   ├── handlers/
│   │   ├── tasks.go      # CRUD handlers
│   │   └── websocket.go  # WebSocket hub
│   ├── models/task.go
│   ├── db/db.go
│   ├── tests/api_test.go
│   └── Dockerfile
│
├── export-service/       # Go Export Service (port 8081)
│   ├── main.go
│   ├── go.mod
│   ├── go.sum            # ✅ Generated
│   ├── handlers/
│   │   ├── export.go
│   │   └── export_test.go
│   └── Dockerfile
│
├── web/                  # React Frontend (Bun + Vite + Tailwind)
│   ├── package.json
│   ├── bun.lockb         # ✅ Generated (converted from npm)
│   ├── vite.config.ts
│   ├── tailwind.config.js
│   ├── index.html
│   ├── src/
│   │   ├── main.tsx
│   │   ├── App.tsx
│   │   ├── index.css
│   │   ├── api/client.ts
│   │   ├── hooks/useWebSocket.ts
│   │   └── components/
│   │       ├── TaskList.tsx
│   │       ├── TaskItem.tsx
│   │       ├── TaskForm.tsx
│   │       └── ExportButton.tsx
│   ├── e2e/todo.spec.ts  # Playwright tests
│   ├── playwright.config.ts
│   └── Dockerfile        # ✅ Updated to use Bun
│
├── k8s/                  # Kubernetes manifests
│   ├── postgres-pvc.yaml
│   ├── postgres-configmap.yaml
│   ├── postgres-deployment.yaml
│   ├── postgres-service.yaml
│   ├── export-deployment.yaml
│   ├── export-service.yaml
│   ├── api-configmap.yaml
│   ├── api-deployment.yaml
│   ├── api-service.yaml
│   ├── web-configmap.yaml
│   ├── web-deployment.yaml
│   └── web-service.yaml
│
├── .booth/
│   └── config.toml       # ✅ Port bindings configured
│
└── seed/seed.sql         # Database seed data
```

## API Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | /api/tasks | List all tasks |
| POST | /api/tasks | Create a task |
| GET | /api/tasks/:id | Get a task |
| PUT | /api/tasks/:id | Update a task |
| DELETE | /api/tasks/:id | Delete a task |
| GET | /api/export?format=csv\|json | Export tasks |
| WS | /ws | WebSocket for real-time updates |

## Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│  KIND Cluster (todo-app namespace)                              │
│                                                                 │
│   ┌──────────────┐      ┌──────────────┐      ┌──────────────┐ │
│   │    React     │      │   Go API     │      │   Export     │ │
│   │   (nginx)    │─────▶│   Service    │─────▶│   Service    │ │
│   │   web:80     │ /api │   api:8080   │ HTTP │ export:8081  │ │
│   └──────────────┘  /ws └──────────────┘      └──────────────┘ │
│          │                    │                                 │
│    port-forward              │                                 │
│          ▼                    ▼                                 │
│      Browser            ┌──────────────┐                       │
│                         │  PostgreSQL  │                       │
│                         │ postgres:5432│                       │
│                         └──────────────┘                       │
└─────────────────────────────────────────────────────────────────┘
```

## Tech Stack

- Frontend: React 18 + TypeScript + Vite + Tailwind CSS + **Bun**
- API: Go 1.21 + Chi router + gorilla/websocket
- Export Service: Go 1.21 + Chi router
- Database: PostgreSQL 15
- Web Server: nginx
- Testing: Go testing + Playwright
- Container: Docker + KIND (Kubernetes)

## Run Tests

```bash
# API tests (run inside cluster)
kubectl exec -it deploy/api -n todo-app -- go test ./tests/...

# Playwright tests (with port-forward running)
cd web && bun run test:e2e
```

## Remove App

```bash
./remove-app.sh
kind delete cluster  # Optional: remove KIND cluster entirely
```
